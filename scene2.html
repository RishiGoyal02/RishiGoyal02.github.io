<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Team Comparison Bar Chart</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style> 
        .bar-denver{
            fill:lightblue;
        }
        .bar-miami{
            fill:maroon;
        }
        .tooltip {
            opacity: 0;
            position: absolute;
            text-align: center;
            width: 60px; height: 40px;
            background:white;
            border: 0px;
        }
        button {
            font-size: 12px;
        }
        #scene3 {
            position: absolute;
            top: 30px;
            left: 1000px;
        }
        #scene1 {
            position: absolute;
            top: 30px;
            left: 50px;
        }
    </style>
</head>
<body>
    <button id = "scene3" onclick="redirectToScene3()">Now you try! Click here to see how teams match up!</button>
    <div name ="tooltip" opacity></div>
    <svg width="1000" height="750"></svg>
    <button id = "scene1" onclick="redirectToScene1()">Previous page</button>
    <script>
        function redirectToScene3() {
            window.location.href = "scene3.html";
        }
        function redirectToScene1() {
            window.location.href = "index.html";
        }
        var tooltip = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
        var svg = d3.select("svg"), width = 500, height = 500;


        var x_ = d3.scaleBand().range([0,width]);
        var y_ = d3.scaleLinear().range([height,0]);

        svg.append("text")
        .attr("transform", "translate(125,0)")
        .attr("x", 325)
        .attr("y", 50)
        .attr("font-size", "36ppx")
        .text("Side by Side comparision of Miami vs. Denver");

        svg.append("text")
        .attr("transform", "translate(10,0)")
        .attr("x", 215)
        .attr("y", 350)
        .attr("font-size", "36ppx")
        .text("Category Value");

        svg.append("text")
        .attr("transform", "translate(10,0)")
        .attr("x", 560)
        .attr("y", 650)
        .attr("font-size", "36ppx")
        .text("Category");

        svg.append("text")
        .attr("x", 25)
        .attr("y", 75)
        .attr("font-size", "12ppx")
        .text("Use your mouse to see exact values on the bars!");

        var g = svg.append("g").attr("transform", "translate("+350+", "+100+")");
        d3.csv("data/Stats.csv").then(function(dataset) {
            var team1 = "Denver Nuggets";
            var team2 = "Miami Heat";
            function filterTeamData(teamName) {
                return dataset.filter(function(team) {
                    return team.Tm === teamName;
                })[0];
            }
            var denverData = filterTeamData(team1);
            var miamiData = filterTeamData(team2);
            var denverPTS = parseFloat(denverData.PTS);
            var denverAST = parseFloat(denverData.AST);
            var denverTRB = parseFloat(denverData.TRB);
            var miamiPTS = parseFloat(miamiData.PTS);
            var miamiAST = parseFloat(miamiData.AST);
            var miamiTRB = parseFloat(miamiData.TRB);

            x_.domain(["PTS", "AST", "TRB"]);
            y_.domain([0, d3.max([denverPTS, denverAST, denverTRB, miamiPTS, miamiAST, miamiTRB])]);

            g.append("g")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x_));
            
            g.append("g")
                .call(d3.axisLeft(y_));
            
            g.selectAll(".bar-denver")
                .data([denverPTS, denverAST, denverTRB])
                .enter().append("rect")
                .attr("class", "bar-denver")
                .attr("x", function(d, i) { return x_("PTS") + 28 + i * x_.bandwidth(); })
                .attr("y", function(d) { return y_(d); })
                .attr("width", function() { return x_.bandwidth() / 3; })
                .attr("height", function(d) { return height - y_(d); })
                .on("mouseover", function(d, i) {
                    tooltip.style("opacity", 1)
                        .style("left", (event.pageX)+"px")
                        .style("top", (event.pageY)+"px")
                        .html("Denver: " + i);
                })
                .on("mouseout", function() {
                    tooltip.style("opacity", 0);
                });
                

            g.selectAll(".bar-miami")
                .data([miamiPTS, miamiAST, miamiTRB])
                .enter().append("rect")
                .attr("class", "bar-miami")
                .attr("x", function(d, i) { return x_("PTS") + 28+ i * x_.bandwidth() + x_.bandwidth() / 3; })
                .attr("y", function(d) { return y_(d); })
                .attr("width", function() { return x_.bandwidth() / 3; })
                .attr("height", function(d) { return height - y_(d); })
                .on("mouseover", function(d, i) {
                    tooltip.style("opacity", 1)
                        .style("left", (event.pageX)+"px")
                        .style("top", (event.pageY)+"px")
                        .html("Miami: " + i );
                })
                .on("mouseout", function() {
                    tooltip.style("opacity", 0);
                });

                var legend = svg.append("g").attr("transform", "translate(800, 100)");

                legend.append("rect")
                    .attr("x", 0)
                    .attr("y", 0)
                    .attr("width", 20)
                    .attr("height", 20)
                    .attr("fill", "lightblue");

                legend.append("text")
                    .attr("x", 30)
                    .attr("y", 15)
                    .text("Denver");

                legend.append("rect")
                    .attr("x", 0)
                    .attr("y", 30)
                    .attr("width", 20)
                    .attr("height", 20)
                    .attr("fill", "maroon");

                legend.append("text")
                    .attr("x", 30)
                    .attr("y", 45)
                    .text("Miami");
        
        });

    </script>
</body>
</html>